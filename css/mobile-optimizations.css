/* Mobile Performance Optimizations */
/* This file contains aggressive optimizations for mobile devices */

/* Basic mobile detection */
@media screen and (max-width: 768px), (pointer: coarse) {
    /* Global mobile optimizations */
    * {
        /* Disable expensive text rendering on mobile */
        -webkit-font-smoothing: auto;
        -moz-osx-font-smoothing: auto;
        text-rendering: auto;
        
        /* Reduce tap highlights */
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
    }
    
    /* Allow text selection where needed */
    .message-content,
    #user-input,
    input,
    textarea {
        -webkit-user-select: text;
        -moz-user-select: text;
        -ms-user-select: text;
        user-select: text;
    }
    
    /* Optimize sidebar for mobile */
    #sidebar {
        /* Fast, simple slide animation */
        transition: transform 0.2s ease-out !important;
        /* Force hardware acceleration */
        transform: translateZ(0);
        will-change: transform;
        backface-visibility: hidden;
        /* Simplify background */
        background: var(--modern-bg-primary) !important;
        /* Reduce shadow complexity */
        box-shadow: 2px 0 10px rgba(0, 0, 0, 0.15) !important;
    }
    
    /* Faster sidebar animation for mid-tier devices */
    .performance-mode #sidebar {
        transition: transform 0.15s linear !important;
        background: #1e293b !important;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1) !important;
    }
    
    /* Optimize sidebar content */
    .sidebar-section {
        /* Simplified styling */
        background: var(--modern-bg-secondary) !important;
        border-radius: 0.5rem !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
        margin: 0.5rem !important;
        /* Remove complex transitions */
        transition: none !important;
    }
    
    .section-header,
    .menu-item {
        /* Simplified hover effects */
        transition: background-color 0.15s ease !important;
    }
    
    /* Remove hover effects that cause repaints on touch devices */
    .section-header:hover,
    .menu-item:hover,
    .header-btn:hover,
    .btn:hover,
    button:hover {
        /* Only change background, no transforms */
        transform: none !important;
        box-shadow: none !important;
    }
    
    /* Optimize messages container */
    .messages-container,
    #messages {
        /* Better scrolling performance */
        -webkit-overflow-scrolling: touch;
        overflow-scrolling: touch;
        transform: translateZ(0);
        /* Reduce layer creation */
        contain: layout style paint;
    }
    
    /* Optimize input area */
    #user-input {
        /* Reduce complexity */
        transition: border-color 0.15s ease !important;
        transform: none !important;
    }
    
    #user-input:focus {
        transform: none !important;
        box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3) !important;
    }
    
    /* Optimize modals */
    .modal,
    #character-gallery {
        /* Faster modal animations */
        transition: opacity 0.2s ease-out, visibility 0.2s ease-out !important;
        transform: none !important;
    }
    
    .modal.show,
    #character-gallery.show {
        transform: none !important;
    }
    
    /* Settings modal gets special handling - don't override its positioning */
    #settings-modal {
        /* Only optimize transition speed, preserve positioning */
        transition: opacity 0.2s ease-out, visibility 0.2s ease-out !important;
    }
    
    /* Simplify character cards */
    .character-card {
        transition: opacity 0.2s ease !important;
        transform: none !important;
    }
    
    .character-card:hover {
        transform: none !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
    }
    
    /* Optimize buttons */
    .header-btn,
    .btn,
    button {
        transition: background-color 0.15s ease, opacity 0.15s ease !important;
        transform: none !important;
    }
    
    .header-btn:active,
    .btn:active,
    button:active {
        transform: none !important;
        opacity: 0.8 !important;
    }
    
    /* Remove complex gradients on mobile */
    .gradient-bg,
    .modern-gradient {
        background: var(--modern-bg-primary) !important;
    }
    
    /* Optimize loading indicators */
    .loading-indicator {
        /* Simple fade instead of complex animations */
        transition: opacity 0.2s ease !important;
        transform: none !important;
    }
    
    /* Disable will-change for better memory usage */
    .will-change-auto {
        will-change: auto !important;
    }
}

/* Additional optimizations for very slow devices */
@media screen and (max-width: 768px) {
    .performance-mode *:not(.file-previews):not(.file-preview):not(.file-previews *) {
        /* Emergency optimizations - disable all animations */
        /* Exclude file preview elements to prevent interference */
        transition: none !important;
        animation: none !important;
        transform: none !important;
        will-change: auto !important;
    }
    
    /* Keep only essential transitions */
    .performance-mode #sidebar {
        transition: opacity 0.15s linear !important;
    }
    
    .performance-mode .modal {
        transition: opacity 0.1s linear !important;
    }
    
    /* Simplify backgrounds */
    .performance-mode .sidebar-section {
        background: #334155 !important;
        border: none !important;
        border-radius: 0.25rem !important;
    }
    
    /* Remove shadows entirely */
    .performance-mode *:not(.file-previews):not(.file-preview):not(.file-previews *) {
        /* Exclude file preview elements to prevent interference */
        box-shadow: none !important;
        text-shadow: none !important;
    }
}

/* Optimizations for devices with low memory */
@media screen and (max-width: 768px) and (max-device-memory: 2GB) {
    /* More aggressive optimizations for low memory devices */
    * {
        /* Reduce layer creation */
        transform-style: flat !important;
        /* Disable expensive filters */
        filter: none !important;
        backdrop-filter: none !important;
        -webkit-backdrop-filter: none !important;
    }
    
    /* Simplify all backgrounds */
    #sidebar,
    .sidebar-section,
    .modal,
    .character-card {
        background-image: none !important;
        background: var(--modern-bg-primary) !important;
    }
    
    /* Disable complex borders */
    * {
        border-radius: 0.25rem !important;
    }
    
    /* Reduce font weights */
    h1, h2, h3, h4, h5, h6 {
        font-weight: 600 !important;
    }
    
    .font-bold {
        font-weight: 600 !important;
    }
}

/* Optimizations for slow connections */
@media screen and (max-width: 768px) {
    /* Hide non-essential visual elements until loaded */
    .character-card img,
    .avatar img {
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .character-card img.loaded,
    .avatar img.loaded {
        opacity: 1;
    }
    
    /* Reduce image quality on slow connections */
    img {
        image-rendering: auto;
    }
}

/* Accessibility optimizations for mobile */
@media (prefers-reduced-motion: reduce) and (max-width: 768px) {
    * {
        transition: none !important;
        animation: none !important;
        transform: none !important;
    }
    
    /* Keep only opacity changes for feedback */
    .header-btn:active,
    .btn:active,
    button:active {
        opacity: 0.7;
        transition: opacity 0.1s ease;
    }
}

/* High contrast mode optimizations for mobile */
@media (prefers-contrast: high) and (max-width: 768px) {
    * {
        /* Remove gradients and complex backgrounds */
        background-image: none !important;
        box-shadow: none !important;
    }
    
    /* Ensure good contrast */
    #sidebar {
        background: #000 !important;
        color: #fff !important;
        border-right: 2px solid #fff !important;
    }
    
    .sidebar-section {
        background: #333 !important;
        border: 1px solid #fff !important;
    }
}

/* Landscape mode optimizations */
@media screen and (max-width: 768px) and (orientation: landscape) {
    /* Optimize for landscape mobile */
    #sidebar {
        /* Faster animation in landscape for better UX */
        transition: transform 0.15s ease-out !important;
    }
    
    /* Reduce vertical spacing in landscape */
    .sidebar-section {
        margin: 0.25rem !important;
        padding: 0.5rem !important;
    }
}

/* iOS Safari specific optimizations */
@supports (-webkit-touch-callout: none) {
    @media screen and (max-width: 768px) {
        /* iOS Safari optimizations */
        #sidebar {
            /* Better performance on iOS */
            -webkit-transform: translateZ(0);
            -webkit-backface-visibility: hidden;
        }
        
        .messages-container {
            /* Smooth scrolling on iOS */
            -webkit-overflow-scrolling: touch;
        }
        
        /* Fix iOS viewport issues */
        .modal {
            position: fixed !important;
            -webkit-transform: translateZ(0);
        }
    }
}

/* Android Chrome specific optimizations */
@media screen and (max-width: 768px) {
    /* Optimize for Android Chrome */
    .keyboard-visible #sidebar {
        /* Faster sidebar when keyboard is open */
        transition: transform 0.1s linear !important;
    }
    
    .keyboard-visible .modal {
        /* Adjust modals for keyboard */
        max-height: 50vh !important;
        overflow-y: auto !important;
    }
}

/* Network-based optimizations */
@media (prefers-reduced-data: reduce) {
    /* Reduce data usage optimizations */
    .character-card img,
    .avatar img {
        display: none;
    }
    
    .character-card::before {
        content: "üìù";
        font-size: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 100px;
    }
}