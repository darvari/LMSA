/* Immersive Professional Settings Modal Theme */

/* Modal background with rich visual backdrop */
#settings-modal {
    background: var(--modal-overlay);
    backdrop-filter: blur(12px) saturate(180%);
    -webkit-backdrop-filter: blur(12px) saturate(180%);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.4s cubic-bezier(0.16, 1, 0.3, 1), visibility 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    position: fixed;
    inset: 0;
    overflow: hidden;
    z-index: 1050;
    /* will-change removed - only apply during transitions */
}

/* Rich immersive background pattern with dynamic effects */
#settings-modal::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    background:
        radial-gradient(circle at 20% 35%, rgba(76, 29, 149, 0.15) 0%, transparent 45%),
        radial-gradient(circle at 80% 10%, rgba(59, 130, 246, 0.12) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(236, 72, 153, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 85% 75%, rgba(16, 185, 129, 0.08) 0%, transparent 45%);
    z-index: -1;
    opacity: 1;
}

/* Animated particle effect overlay */
#settings-modal::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    height: 100%;
    background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Ccircle cx='10' cy='10' r='1'/%3E%3Ccircle cx='25' cy='30' r='0.5'/%3E%3Ccircle cx='40' cy='15' r='0.8'/%3E%3Ccircle cx='55' cy='35' r='0.6'/%3E%3Ccircle cx='70' cy='10' r='1'/%3E%3Ccircle cx='85' cy='25' r='0.5'/%3E%3Ccircle cx='92' cy='40' r='0.8'/%3E%3Ccircle cx='15' cy='65' r='0.7'/%3E%3Ccircle cx='32' cy='80' r='0.4'/%3E%3Ccircle cx='50' cy='50' r='1'/%3E%3Ccircle cx='65' cy='70' r='0.6'/%3E%3Ccircle cx='80' cy='85' r='0.7'/%3E%3Ccircle cx='95' cy='55' r='0.5'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    z-index: -1;
    opacity: 0.8;
    animation: floatingParticles 120s linear infinite;
}

/* Modal content with immersive, premium styling */
#settings-modal .modal-content {
    background: var(--modal-bg);
    border: 1px solid var(--border-color);
    border-radius: 1.5rem;
    box-shadow:
        0 25px 50px -12px var(--modal-overlay),
        0 0 0 1px var(--border-color) inset,
        0 1px 3px 0 var(--border-color) inset;
    /* Enhanced appearance for light mode */
    .light-theme & {
        background: linear-gradient(to bottom, rgba(255, 255, 255, 0.98), rgba(248, 250, 252, 0.95));
        box-shadow:
            0 25px 50px -12px rgba(15, 23, 42, 0.15),
            0 0 0 1px rgba(226, 232, 240, 0.7) inset,
            0 1px 3px 0 rgba(226, 232, 240, 0.5) inset,
            0 1px 0 rgba(255, 255, 255, 0.6);
        border: 1px solid rgba(203, 213, 225, 0.5);
    }
    position: relative;
    overflow: hidden;
    margin: auto;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    z-index: 1052;
    max-width: 90%;
    width: 96%;
    max-height: 85vh; /* Limit height to prevent overflow */
    display: flex;
    flex-direction: column;
    box-sizing: border-box; /* Ensure padding is included in width calculation */
    transform-origin: center center;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    /* Ensure the modal stays centered */
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    /* will-change removed - only apply during transitions */
}

/* Premium edge highlight with animated gradient border */
#settings-modal .modal-content::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 1.5rem;
    padding: 1.5px;
    background: linear-gradient(300deg,
        rgba(59, 130, 246, 0.7) 0%,
        rgba(147, 51, 234, 0.7) 20%,
        rgba(236, 72, 153, 0.7) 40%,
        rgba(16, 185, 129, 0.7) 60%,
        rgba(245, 158, 11, 0.7) 80%,
        rgba(59, 130, 246, 0.7) 100%);
    background-size: 300% 300%;
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
    opacity: 0.9;
    animation: gradientBorder 8s linear infinite;
}

/* Professional settings header with clean styling */
#settings-modal #settings-title {
    padding-bottom: 1rem;
    margin-bottom: 1.5rem;
    font-weight: 700;
    letter-spacing: 0.02em;
    position: relative;
    display: flex;
    align-items: center;
    font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    font-size: 1.5rem;
    color: var(--modal-title);
    text-shadow: var(--title-shadow);
    /* Ensure crisp text rendering */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

/* Professional underline effect */
#settings-modal #settings-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: var(--title-border);
    border-radius: 1px;
    opacity: 0.9;
}

/* Modern professional settings icon */
#settings-modal #settings-title i {
    color: var(--header-icon);
    margin-right: 1rem;
    font-size: 1.25rem;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(79, 70, 229, 0.9));
    border-radius: 12px;
    box-shadow:
        0 4px 8px rgba(0, 0, 0, 0.15),
        0 0 0 1px rgba(255, 255, 255, 0.1) inset;
    transition: all 0.3s ease;
    z-index: 1;
    transform: rotate(0deg);
}

/* Icon subtle hover effect */
#settings-modal:hover #settings-title i {
    transform: rotate(30deg);
    background: linear-gradient(135deg, rgba(79, 70, 229, 0.9), rgba(59, 130, 246, 0.9));
}

/* Icon content positioning */
#settings-modal #settings-title i::before {
    position: relative;
    z-index: 2;
}

/* Subtle accent for icon */
#settings-modal #settings-title i::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), transparent);
    border-radius: 12px;
    z-index: 1;
    opacity: 0.5;
}

/* Immersive animations for the entire modal */
@keyframes settingsModalFadeIn {
    0% { opacity: 0; }
    100% { opacity: 1; }
}

@keyframes settingsModalFadeOut {
    0% { opacity: 1; }
    100% { opacity: 0; }
}

@keyframes modalContentReveal {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.96); }
    100% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
}

@keyframes modalContentHide {
    0% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.96); }
}

@keyframes shimmer {
    0% { background-position: 0% 50%; }
    100% { background-position: 200% 50%; }
}

@keyframes gradientBorder {
    0% { background-position: 0% 50%; }
    100% { background-position: 300% 50%; }
}

@keyframes floatingParticles {
    0% { transform: translateY(0) translateX(0); }
    25% { transform: translateY(-5px) translateX(5px); }
    50% { transform: translateY(0) translateX(10px); }
    75% { transform: translateY(5px) translateX(5px); }
    100% { transform: translateY(0) translateX(0); }
}

/* Class to force repaint when theme changes */
#settings-modal.theme-update {
    animation: none;
    transition: none;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

@keyframes glow {
    0% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5), 0 0 10px rgba(59, 130, 246, 0.3); }
    50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8), 0 0 30px rgba(59, 130, 246, 0.5); }
    100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5), 0 0 10px rgba(59, 130, 246, 0.3); }
}

/* Premium help button with immersive styling */
#settings-modal #settings-help-btn {
    background: linear-gradient(135deg, #ff8a00, #e63c00);
    color: white;
    border: none;
    box-shadow:
        0 4px 6px rgba(0, 0, 0, 0.1),
        0 2px 4px rgba(0, 0, 0, 0.06),
        0 0 1px rgba(255, 255, 255, 0.1) inset,
        0 0 15px rgba(230, 60, 0, 0.2);
    font-weight: 600;
    padding: 0.85rem 1.5rem;
    border-radius: 0.75rem;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    letter-spacing: 0.02em;
}

/* Button glow effects */
#settings-modal #settings-help-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255, 138, 0, 0.5), rgba(230, 60, 0, 0.5));
    filter: blur(15px);
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: -1;
    transform: translateY(5px);
}

#settings-modal #settings-help-btn:hover::before {
    opacity: 0.7;
}

/* Premium section headers with immersive styling */
#settings-modal .settings-step label.block.text-sm.font-medium {
    color: var(--settings-label-text);
    font-weight: 600;
    background: var(--settings-label-bg);
    padding: 1rem 1.5rem;
    border-radius: 1rem;
    border-left: none;
    margin-bottom: 1.5rem;
    box-shadow:
        0 4px 20px var(--modal-overlay),
        0 0 0 1px var(--border-color) inset,
        0 0 15px rgba(59, 130, 246, 0.2);
    /* Enhanced appearance for light mode */
    .light-theme & {
        background: linear-gradient(135deg, rgba(248, 250, 252, 0.9), rgba(241, 245, 249, 0.9));
        color: #1e293b;
        box-shadow:
            0 4px 15px rgba(15, 23, 42, 0.05),
            0 0 0 1px rgba(226, 232, 240, 0.8) inset,
            0 0 10px rgba(59, 130, 246, 0.1);
        border-bottom: 1px solid rgba(226, 232, 240, 0.8);
    }
    letter-spacing: 0.03em;
    display: flex;
    align-items: center;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    overflow: hidden;
    font-size: 1rem;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
}

/* Section header hover effect */
#settings-modal .settings-step label.block.text-sm.font-medium:hover {
    box-shadow:
        0 4px 25px var(--modal-overlay),
        0 0 0 1px var(--border-color-hover) inset,
        0 0 20px rgba(59, 130, 246, 0.3);
    transform: translateY(-2px);
}

/* Section header icon glow effect */
#settings-modal .settings-step label.block.text-sm.font-medium i {
    color: var(--toggle-active-bg);
    margin-right: 0.75rem;
    font-size: 1.1rem;
    filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.6));
    position: relative;
    z-index: 1;

    /* Enhanced appearance for light mode */
    .light-theme & {
        color: #3b82f6;
        filter: drop-shadow(0 0 5px rgba(59, 130, 246, 0.4));
    }
}

/* Glowing accent for section headers */
#settings-modal .settings-step label.block.text-sm.font-medium::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 4px;
    height: 100%;
    background: linear-gradient(to bottom, #3b82f6, #8b5cf6, #ec4899);
    box-shadow: 0 0 15px rgba(59, 130, 246, 0.7);
    border-radius: 4px 0 0 4px;
}

/* Left border */
#settings-modal .settings-step label.block.text-sm.font-medium::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 3px;
    height: 100%;
    background: #3b82f6;
}

#settings-modal .settings-step label.block.text-sm.font-medium:hover {
    background: var(--settings-label-bg);
    transform: translateX(2px);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
}

/* Premium input fields with immersive styling */
#settings-modal input[type="text"],
#settings-modal input[type="number"],
#settings-modal textarea {
    background: var(--settings-input-bg);
    color: var(--settings-input-text);
    border: 1px solid var(--settings-input-border);
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    border-radius: 0.75rem;
    padding: 1rem 1.2rem;
    box-shadow:
        0 4px 10px var(--modal-overlay),
        inset 0 1px 3px var(--modal-overlay),
        0 0 0 1px var(--border-color);
    /* Enhanced appearance for light mode */
    .light-theme & {
        background: rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(203, 213, 225, 0.8);
        box-shadow:
            0 2px 5px rgba(15, 23, 42, 0.05),
            inset 0 1px 2px rgba(148, 163, 184, 0.05),
            0 0 0 1px rgba(226, 232, 240, 0.5);
    }
    font-size: 0.95rem;
    position: relative;
    width: 100%;
    font-family: 'Segoe UI', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
}

/* Premium focus effect with glow */
#settings-modal input[type="text"]:focus,
#settings-modal input[type="number"]:focus,
#settings-modal textarea:focus {
    background: var(--settings-input-bg);
    border-color: var(--toggle-active-bg);
    outline: none;
    box-shadow:
        0 4px 15px var(--modal-overlay),
        0 0 0 1px var(--toggle-active-border),
        0 0 15px rgba(59, 130, 246, 0.3);
    /* Enhanced appearance for light mode */
    .light-theme & {
        background: rgba(255, 255, 255, 0.95);
        border-color: rgba(59, 130, 246, 0.8);
        box-shadow:
            0 4px 12px rgba(15, 23, 42, 0.05),
            0 0 0 1px rgba(59, 130, 246, 0.6),
            0 0 0 3px rgba(59, 130, 246, 0.2);
    }
    transform: translateY(-1px);
}

/* Placeholder text */
#settings-modal input[type="text"]::placeholder,
#settings-modal input[type="number"]::placeholder,
#settings-modal textarea::placeholder {
    color: var(--input-placeholder);
    font-style: normal;
}

/* IP and Port inputs with icons */
#server-ip {
    padding-left: 1rem;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='18' height='18' fill='none' stroke='%233b82f6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='2' y='2' width='20' height='8' rx='2' ry='2'%3E%3C/rect%3E%3Crect x='2' y='14' width='20' height='8' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='6' y1='6' x2='6.01' y2='6'%3E%3C/line%3E%3Cline x1='6' y1='18' x2='6.01' y2='18'%3E%3C/line%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: 0.6rem center; /* Moved icon slightly to the right */
    padding-left: 2.4rem; /* Increased left padding to prevent text from overlapping icon */
    background-size: 14px;
    transition: all 0.2s ease;
    position: relative;
    background-color: var(--settings-input-bg);
    color: var(--settings-input-text);
    text-indent: 0; /* Removed text indent as it's not needed with increased padding */
    box-sizing: border-box; /* Ensure padding is included in width calculation */
    width: 100%; /* Ensure the input takes full width of its container */
}

#server-ip:focus {
    background-position: 0.6rem center; /* Keep consistent with non-focus state */
    padding-left: 2.4rem; /* Keep consistent with non-focus state */
    background-color: var(--settings-input-bg);
    border-color: var(--toggle-active-bg);
    text-indent: 0; /* Removed text indent */
}

#server-port {
    padding-left: 1rem;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='18' height='18' fill='none' stroke='%233b82f6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2'%3E%3C/path%3E%3Crect x='8' y='2' width='8' height='4' rx='1' ry='1'%3E%3C/rect%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: 0.4rem center; /* Moved icon slightly to the right */
    padding-left: 1.7rem; /* Increased left padding */
    padding-right: 0.5rem; /* Increased right padding to prevent text from being cut off */
    background-size: 10px;
    transition: all 0.2s ease;
    position: relative;
    background-color: var(--settings-input-bg);
    color: var(--settings-input-text);
    text-indent: 0; /* No text indent for port field */
    font-size: 0.85rem; /* Even smaller font size for port field */
    letter-spacing: -0.01rem; /* Slightly tighter letter spacing */
    box-sizing: border-box; /* Ensure padding is included in width calculation */
    width: 100%; /* Ensure the input takes full width of its container */
}

#server-port:focus {
    background-position: 0.4rem center; /* Keep consistent with non-focus state */
    padding-left: 1.7rem; /* Keep consistent with non-focus state */
    padding-right: 0.5rem; /* Keep consistent with non-focus state */
    background-color: var(--settings-input-bg);
    border-color: var(--toggle-active-bg);
    text-indent: 0; /* No text indent for port field */
}

/* IP and Port container */
.ip-port-container {
    position: relative;
    display: flex;
    gap: 0.75rem; /* Increased gap between IP and port fields */
    width: 100%; /* Ensure container takes full width */
    padding: 0 0.1rem; /* Add slight padding to prevent edge cutoff */
    box-sizing: border-box; /* Ensure padding is included in width calculation */
}

/* Port input container */
.port-input-container {
    min-width: 7rem; /* Ensure minimum width for port container */
    flex-shrink: 0; /* Prevent container from shrinking */
    padding-right: 0.25rem; /* Add padding to prevent right edge cutoff */
    box-sizing: border-box; /* Ensure padding is included in width calculation */
}

/* Field labels */
#settings-modal label.block.text-xs {
    color: var(--settings-label-text);
    font-weight: 500;
    margin-bottom: 0.5rem;
    display: inline-block;
    letter-spacing: 0.01em;
    font-size: 0.85rem;
    position: relative;
    font-family: 'Segoe UI', system-ui, sans-serif;
}

/* Help text panels */
#settings-modal p.text-xs.text-gray-300,
#settings-modal p.text-xs.text-gray-400 {
    color: var(--settings-help-text);
    background: var(--settings-label-bg);
    padding: 0.7rem 1rem;
    border-radius: 0.4rem;
    margin-top: 0.6rem;
    border-left: 2px solid rgba(59, 130, 246, 0.5);
    font-size: 0.85rem;
    line-height: 1.5;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    position: relative;
}

/* Info icon */
#settings-modal p.text-xs.text-gray-300::before,
#settings-modal p.text-xs.text-gray-400::before {
    content: 'â„¹';
    position: absolute;
    left: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.9rem;
    color: var(--toggle-active-bg);
    font-weight: bold;
    font-style: normal;
}

#settings-modal em.text-xs {
    color: var(--toggle-active-bg);
    font-weight: bold;
}

#settings-modal p.text-xs.text-gray-300,
#settings-modal p.text-xs.text-gray-400 {
    padding-left: 1.8rem;
}

/* URL text */
#settings-modal p.text-xs span.text-blue-400 {
    color: var(--toggle-active-bg);
    font-weight: 600;
    background: rgba(59, 130, 246, 0.15);
    padding: 0.2rem 0.4rem;
    border-radius: 0.3rem;
    transition: all 0.2s ease;
    display: inline-block;
}

/* URL hover effect */
#settings-modal p.text-xs span.text-blue-400:hover {
    background: rgba(59, 130, 246, 0.25);
    transform: translateY(-1px);
}

/* Toggle switches - improved design */
#settings-modal .toggle-switch {
    background: var(--toggle-bg);
    border-radius: 1rem;
    width: 50px;
    height: 24px;
    transition: all 0.3s ease;
    position: relative;
    cursor: pointer;
    box-shadow:
        inset 0 1px 3px rgba(0, 0, 0, 0.2),
        0 1px 2px rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(0, 0, 0, 0.2);
    /* Enhanced appearance for light mode */
    .light-theme & {
        background: #e2e8f0;
        border: 1px solid #cbd5e1;
        box-shadow:
            inset 0 1px 3px rgba(148, 163, 184, 0.1),
            0 1px 2px rgba(255, 255, 255, 0.8);
    }
    overflow: hidden;
}

/* Toggle switch background glow effect */
#settings-modal .toggle-switch::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 30% 50%, var(--toggle-active-border), transparent 50%);
    opacity: 0;
    transition: opacity 0.4s ease;
    z-index: 1;
}

#settings-modal .toggle-dot {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 18px;
    height: 18px;
    background: white;
    border-radius: 50%;
    transition: all 0.3s ease;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    /* Enhanced appearance for light mode */
    .light-theme & {
        background: white;
        box-shadow: 0 1px 3px rgba(15, 23, 42, 0.2);
    }
    z-index: 2;
}

/* Remove toggle dot inner glow for cleaner appearance */
#settings-modal .toggle-dot::after {
    display: none;
}

/* Improved active toggle with subtle effect */
#settings-modal input[type="checkbox"]:checked ~ .toggle-switch {
    background: #3b82f6;
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    border: 1px solid #2563eb;
    /* Enhanced appearance for light mode */
    .light-theme & {
        background: #3b82f6;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        border: 1px solid #2563eb;
    }
}

/* Active toggle switch inner glow */
#settings-modal input[type="checkbox"]:checked ~ .toggle-switch::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at 70% 50%, rgba(96, 165, 250, 0.6), transparent 70%);
    z-index: 1;
    opacity: 0.8;
    border-radius: 1rem;
    animation: pulse 2s infinite;
}

#settings-modal input[type="checkbox"]:checked ~ .toggle-dot {
    background: white;
    transform: translateX(28px);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);

    /* Enhanced appearance for light mode */
    .light-theme & {
        background: white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }
}

/* Subtle hover effects */
#settings-modal .toggle-container:hover .toggle-dot {
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);

    /* Enhanced appearance for light mode */
    .light-theme & {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
}

#settings-modal .toggle-container:hover input[type="checkbox"]:checked ~ .toggle-dot {
    transform: translateX(28px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);

    /* Enhanced appearance for light mode */
    .light-theme & {
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
}

/* Toggle container to ensure proper alignment */
#settings-modal .toggle-container {
    display: flex;
    align-items: center;
    position: relative;
    flex-shrink: 0; /* Prevent container from shrinking */
    margin-left: 12px; /* Add more spacing from the label */
    margin-right: 4px; /* Add spacing on the right to prevent being cut off */
    min-width: 50px; /* Ensure minimum width for the toggle */
}

/* Next buttons */
#settings-modal button[id^="to-"] {
    background: linear-gradient(135deg, #4f46e5, #3b82f6);
    border: none;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06), 0 0 1px rgba(255, 255, 255, 0.1) inset;
    font-weight: 500;
    padding: 0.8rem 1.2rem;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
    position: relative;
    overflow: hidden;
    color: #ffffff;
    font-family: 'Segoe UI', system-ui, sans-serif;
    font-size: 0.9rem;

    /* Enhanced appearance for light mode */
    .light-theme & {
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        box-shadow:
            0 4px 6px rgba(15, 23, 42, 0.08),
            0 2px 4px rgba(15, 23, 42, 0.05),
            0 0 1px rgba(255, 255, 255, 0.5) inset,
            0 -1px 0 rgba(0, 0, 0, 0.1) inset;
        text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
        font-weight: 600;
    }
}

/* Hover state */
#settings-modal button[id^="to-"]:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05), 0 0 1px rgba(255, 255, 255, 0.2) inset;
    background: linear-gradient(135deg, #4338ca, #3b82f6);

    /* Enhanced appearance for light mode */
    .light-theme & {
        background: linear-gradient(135deg, #2563eb, #1d4ed8);
        box-shadow:
            0 6px 15px rgba(15, 23, 42, 0.1),
            0 4px 6px rgba(15, 23, 42, 0.05),
            0 0 1px rgba(255, 255, 255, 0.5) inset;
    }
}

/* Focus state for keyboard navigation */
#settings-modal button[id^="to-"]:focus-visible {
    outline: 2px solid #60a5fa;
    outline-offset: 2px;
    box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.3);
    transform: translateY(-2px);

    /* Enhanced appearance for light mode */
    .light-theme & {
        outline: 2px solid #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.25);
    }
}

/* Active state */
#settings-modal button[id^="to-"]:active {
    transform: translateY(1px);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);

    /* Enhanced appearance for light mode */
    .light-theme & {
        box-shadow: 0 1px 2px rgba(15, 23, 42, 0.1);
    }
}

/* Icon */
#settings-modal button[id^="to-"] i {
    margin-right: 0.5rem;
    font-size: 1rem;
    position: relative;
}

/* Back buttons */
#settings-modal button[id^="back-"] {
    background: var(--settings-label-bg);
    color: var(--text-primary);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    font-weight: 500;
    padding: 0.7rem 1.2rem;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px var(--modal-overlay);
    position: relative;
    font-family: 'Segoe UI', system-ui, sans-serif;
    font-size: 0.9rem;

    /* Enhanced appearance for light mode */
    .light-theme & {
        background: linear-gradient(to bottom, rgba(248, 250, 252, 0.9), rgba(241, 245, 249, 0.9));
        color: #1e293b;
        border: 1px solid rgba(203, 213, 225, 0.5);
        box-shadow:
            0 2px 4px rgba(15, 23, 42, 0.05),
            0 1px 0 rgba(255, 255, 255, 0.8) inset;
    }
}

/* Hover state for back buttons */
#settings-modal button[id^="back-"]:hover {
    background: var(--settings-input-bg);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px var(--modal-overlay);

    /* Enhanced appearance for light mode */
    .light-theme & {
        background: rgba(255, 255, 255, 0.95);
        box-shadow:
            0 4px 8px rgba(15, 23, 42, 0.05),
            0 1px 0 rgba(255, 255, 255, 1) inset;
        border-color: rgba(203, 213, 225, 0.8);
    }
}

/* Focus state for keyboard navigation */
#settings-modal button[id^="back-"]:focus-visible {
    outline: 2px solid var(--toggle-active-bg);
    outline-offset: 2px;
    box-shadow: 0 0 0 4px var(--toggle-active-border);
    transform: translateY(-2px);

    /* Enhanced appearance for light mode */
    .light-theme & {
        outline: 2px solid #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.25);
    }
}

/* Active state for back buttons */
#settings-modal button[id^="back-"]:active {
    transform: translateY(1px);
    box-shadow: 0 1px 2px var(--modal-overlay);
}

/* Icon for back buttons */
#settings-modal button[id^="back-"] i {
    margin-right: 0.5rem;
    font-size: 1rem;
    position: relative;
}

/* Elegant separator between navigation buttons and save button */
.flex.justify-center.items-center.my-3.lg\:hidden {
    margin-top: 0.75rem;
    margin-bottom: 0.75rem;
}

/* Separator line */
.flex.justify-center.items-center.my-3.lg\:hidden .h-\[1px\].w-1\/3 {
    height: 1px;
    background: linear-gradient(to right, transparent, rgba(148, 163, 184, 0.4), transparent);
}

/* Separator dot */
.flex.justify-center.items-center.my-3.lg\:hidden .w-1\.5.h-1\.5 {
    box-shadow: 0 0 5px rgba(59, 130, 246, 0.5);
}

/* Responsive adjustments for iPhone SE and other small screens */
@media (max-width: 375px) {
    .flex.justify-center.items-center.my-3.lg\:hidden {
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
    }

    .flex.justify-center.items-center.my-3.lg\:hidden .w-1\.5.h-1\.5 {
        width: 4px;
        height: 4px;
    }
}

/* Save button */
#settings-modal #close-settings {
    background: var(--button-success-bg);
    border: none;
    box-shadow: 0 4px 6px var(--modal-overlay), 0 2px 4px var(--modal-overlay), 0 0 1px var(--border-color) inset;

    /* Enhanced appearance for light mode */
    .light-theme & {
        background: linear-gradient(135deg, #0ea5e9, #0284c7);
        box-shadow:
            0 4px 6px rgba(15, 23, 42, 0.1),
            0 2px 4px rgba(15, 23, 42, 0.05),
            0 0 1px rgba(255, 255, 255, 0.5) inset,
            0 -1px 0 rgba(0, 0, 0, 0.1) inset;
    }
    font-weight: 600;
    padding: 1rem 1.5rem;
    border-radius: 0.75rem;
    transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    position: relative;
    overflow: hidden;
    margin-top: 0.75rem; /* Reduced top margin to minimize gap with navigation buttons */
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
    letter-spacing: 0.03em;
    font-family: 'Segoe UI', system-ui, sans-serif;
    font-size: 0.95rem;
    width: 100%;
    flex-shrink: 0; /* Prevent button from shrinking */
    z-index: 5; /* Ensure button is above scrollable content */
}

/* Hover state */
#settings-modal #close-settings:hover {
    background: linear-gradient(135deg, #059669, #10b981);
    transform: translateY(-3px);
    box-shadow: 0 6px 12px rgba(5, 150, 105, 0.2), 0 4px 6px rgba(5, 150, 105, 0.1);
}

/* Active state */
#settings-modal #close-settings:active {
    transform: translateY(1px);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
}

/* Save icon */
#settings-modal #close-settings i {
    color: #ffffff;
    margin-right: 0.5rem;
    font-size: 1.1rem;
    position: relative;
}

/* Temperature slider */
#settings-modal input[type="range"] {
    background: #3b82f6;
    border-radius: 0.5rem;
    height: 0.5rem;
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;
    cursor: pointer;
    position: relative;
    overflow: visible;
}

/* Slider thumb */
#settings-modal input[type="range"]::-webkit-slider-thumb {
    background: #ffffff;
    border: 2px solid #3b82f6;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    border-radius: 50%;
    width: 18px;
    height: 18px;
    transition: all 0.2s ease;
    cursor: pointer;
    position: relative;
    z-index: 3;
}

/* Hover effect for thumb */
#settings-modal input[type="range"]::-webkit-slider-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
}

/* Firefox support */
#settings-modal input[type="range"]::-moz-range-thumb {
    background: #ffffff;
    border: 2px solid #3b82f6;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    border-radius: 50%;
    width: 18px;
    height: 18px;
    transition: all 0.2s ease;
    cursor: pointer;
    position: relative;
    z-index: 3;
}

#settings-modal input[type="range"]::-moz-range-thumb:hover {
    transform: scale(1.1);
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3);
}

/* Temperature value display */
#settings-modal #temperature-value {
    color: #ffffff;
    font-weight: 600;
    background: var(--toggle-active-bg);
    padding: 0.2rem 0.5rem;
    border-radius: 0.3rem;
    margin-left: 0.5rem;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    transition: all 0.2s ease;
    position: relative;
    display: inline-block;
    min-width: 2rem;
    text-align: center;
}

/* Settings content wrapper */
#settings-content-wrapper {
    overflow-y: auto;
    max-height: calc(85vh - 160px); /* Adjust based on header and footer height */
    padding-right: 12px; /* Add padding for scrollbar */
    margin-right: -12px; /* Offset padding to maintain alignment */
    scrollbar-width: thin;
    scrollbar-color: rgba(59, 130, 246, 0.5) rgba(30, 41, 59, 0.2);
    scroll-behavior: smooth;
    overscroll-behavior: contain;
}

/* Webkit scrollbar styles */
#settings-content-wrapper::-webkit-scrollbar {
    width: 8px;
    background-color: rgba(30, 41, 59, 0.1);
    border-radius: 8px;
}

#settings-content-wrapper::-webkit-scrollbar-track {
    background: var(--scrollbar-track);
    border-radius: 5px;
    box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
}

#settings-content-wrapper::-webkit-scrollbar-thumb {
    background-color: var(--scrollbar-thumb);
    border-radius: 5px;
    border: 2px solid var(--scrollbar-track);
    box-shadow: 0 0 2px rgba(0, 0, 0, 0.2);
}

#settings-content-wrapper::-webkit-scrollbar-thumb:hover,
#settings-content-wrapper::-webkit-scrollbar-thumb:active {
    background-color: var(--scrollbar-thumb-hover);
}

/* Fix for the close button X to remove circle effect when clicked */
#settings-modal #close-settings-x {
    outline: none;
}

#settings-modal #close-settings-x:focus,
#settings-modal #close-settings-x:focus-visible {
    outline: none;
    box-shadow: none;
    border: none;
}

/* Mobile navigation styles */
.settings-step {
    transition: all 0.3s ease;
    min-height: fit-content; /* Ensure content fits without scrolling */
    padding-bottom: 10px; /* Add some padding at the bottom */
}

.settings-step.hidden {
    display: none;
}

.settings-step.active {
    display: block;
    -webkit-overflow-scrolling: touch; /* Enable smooth scrolling on iOS */
    touch-action: pan-y; /* Allow vertical touch scrolling */
    overscroll-behavior: contain; /* Prevent body scroll when reaching top/bottom */
}

.slide-in-right {
    animation: slideInRight 0.3s forwards;
}

.slide-in-left {
    animation: slideInLeft 0.3s forwards;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideInLeft {
    from {
        transform: translateX(-100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* Show/hide animations */
#settings-modal.show {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    animation: settingsModalFadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

#settings-modal.show .modal-content {
    animation: modalContentReveal 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

#settings-modal.hide {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    animation: settingsModalFadeOut 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
}

#settings-modal.hide .modal-content {
    animation: modalContentHide 0.4s cubic-bezier(0.22, 1, 0.36, 1) forwards;
}

#settings-modal.hidden {
    display: none;
}

/* Animation for modal content */
@keyframes modalFadeIn {
    from { opacity: 0; transform: scale(0.95) translateY(10px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
}

.animate-modal-in {
    animation: modalFadeIn 0.3s ease-out forwards;
}

/* Navigation buttons container */
#settings-navigation-buttons {
    display: flex;
    flex-direction: column;
    width: 100%;
    margin-top: 1rem;
    margin-bottom: 0.25rem; /* Further reduced bottom margin to minimize gap */
    z-index: 10;
    position: relative;
}

/* Navigation button groups */
#settings-navigation-buttons .navigation-buttons {
    display: flex;
    width: 100%;
    gap: 0.75rem;
}

#settings-navigation-buttons .navigation-buttons.hidden {
    display: none;
}

/* Mobile/tablet navigation buttons */
@media (max-width: 1023px) {
    /* Ensure navigation buttons are visible and properly styled */
    #settings-navigation-buttons {
        display: flex !important;
        flex-shrink: 0; /* Prevent buttons from shrinking */
    }

    /* Ensure navigation buttons are properly styled and clickable */
    #settings-modal button[id^="to-"],
    #settings-modal button[id^="back-"] {
        position: relative;
        z-index: 11; /* Higher z-index than the container */
        touch-action: manipulation; /* Optimize for touch */
        -webkit-tap-highlight-color: rgba(0,0,0,0); /* Remove tap highlight on iOS */
        cursor: pointer;
        user-select: none; /* Prevent text selection */
        min-height: 44px; /* Ensure minimum height for touch targets */
    }

    /* Remove extra padding at the bottom of steps since buttons are now static */
    #settings-modal .settings-step {
        padding-bottom: 0.5rem;
    }

    /* Fix for small screens to prevent toggle switches from being cut off */
    @media (max-width: 767px) {
        /* Ensure toggle containers have proper spacing and don't get cut off */
        #settings-modal .flex.justify-between.items-center {
            padding-right: 12px; /* Increased padding to prevent content from touching the edge */
            margin-right: 0; /* Remove any margin that might push content off-screen */
            width: 100%; /* Ensure full width */
            box-sizing: border-box; /* Include padding in width calculation */
            overflow: visible; /* Ensure content isn't cut off */
        }

        /* Ensure labels don't push toggles off-screen */
        #settings-modal .flex.justify-between.items-center label {
            flex: 1; /* Allow label to shrink if needed */
            padding-right: 8px; /* Add some spacing between label and toggle */
            font-size: 0.9rem; /* Slightly smaller font on very small screens */
        }

        /* Ensure modal content has proper padding */
        #settings-modal .modal-content {
            padding: 1rem; /* Consistent padding */
            width: 92%; /* Slightly narrower to ensure content fits */
            max-width: 92%; /* Match the width */
        }

        /* Ensure scrollbar is visible on small screens */
        #settings-content-wrapper::-webkit-scrollbar {
            width: 8px; /* Slightly smaller on mobile */
        }

        #settings-content-wrapper {
            margin-right: -8px; /* Smaller offset for mobile */
            padding-right: 8px; /* Smaller padding for mobile */
        }

        /* Adjust navigation buttons for small screens */
        #settings-navigation-buttons {
            margin-top: 0.75rem;
            margin-bottom: 0.25rem; /* Further reduced for mobile */
        }

        #settings-navigation-buttons .navigation-buttons {
            gap: 0.5rem;
        }

        /* Reduce the gap between navigation buttons and save button on mobile */
        #settings-modal .mt-2 {
            margin-top: 0.5rem !important;
        }

        #settings-modal button[id^="to-"],
        #settings-modal button[id^="back-"] {
            padding: 0.6rem 1rem;
            font-size: 0.85rem;
        }

        /* iPhone SE specific optimizations */
        @media (min-width: 361px) and (max-width: 375px) {
            /* Optimize modal padding for iPhone SE */
            #settings-modal .modal-content {
                padding: 0.85rem !important;
                width: 95% !important;
                max-width: 95% !important;
            }

            /* Optimize form elements for iPhone SE */
            #settings-modal input[type="text"],
            #settings-modal input[type="number"],
            #settings-modal textarea {
                padding: 0.75rem 1rem !important;
                font-size: 0.9rem !important;
                min-height: 44px !important; /* Better touch target */
            }

            /* Ensure buttons have proper touch targets */
            #settings-modal button {
                min-height: 44px !important;
            }

            /* Optimize navigation buttons for iPhone SE */
            #settings-navigation-buttons {
                margin-top: 0.6rem !important;
                margin-bottom: 0.2rem !important; /* Further reduced for iPhone SE */
            }

            #settings-navigation-buttons .navigation-buttons {
                gap: 0.4rem !important;
            }

            /* Optimize separator for iPhone SE */
            .flex.justify-center.items-center.my-3.lg\:hidden {
                margin-top: 0.4rem !important;
                margin-bottom: 0.4rem !important;
            }

            /* Minimize gap between navigation and save button for iPhone SE */
            #settings-modal .mt-1 {
                margin-top: 0.2rem !important;
            }

            #settings-modal button[id^="to-"],
            #settings-modal button[id^="back-"] {
                padding: 0.6rem 0.9rem !important;
                font-size: 0.85rem !important;
            }

            /* Optimize toggle switches for iPhone SE */
            #settings-modal .flex.justify-between.items-center label {
                font-size: 0.85rem !important;
                padding-right: 6px !important;
            }

            /* Optimize section headers for iPhone SE */
            #settings-modal .settings-step label.block.text-sm.font-medium {
                padding: 0.85rem 1.2rem !important;
                font-size: 0.9rem !important;
                margin-bottom: 1.2rem !important;
            }
        }
    }

    /* Specific fix for tablet view */
    @media (min-width: 768px) {
        #settings-navigation-buttons {
            margin-top: 1.25rem;
            margin-bottom: 1rem;
        }

        /* Make buttons larger on tablets for better touch targets */
        #settings-modal button[id^="to-"],
        #settings-modal button[id^="back-"] {
            min-height: 50px;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
        }

        /* Fix for tablet view to prevent right edge from being cut off */
        #settings-modal .modal-content {
            width: 90%;
            max-width: 90%;
            padding: 1.25rem;
            box-sizing: border-box;
            overflow-x: visible;
        }

        /* Ensure toggle containers have proper spacing and don't get cut off */
        #settings-modal .flex.justify-between.items-center {
            padding-right: 12px;
            margin-right: 0;
            width: 100%;
            box-sizing: border-box;
        }
    }
}

/* Desktop view - enhanced layout for showing all settings at once */
@media (min-width: 1024px) {
    #settings-modal .modal-content {
        width: 750px;
        max-width: 80%;
        max-height: 80vh;
        padding: 2rem;
    }

    /* Make each settings step more compact */
    #settings-modal .settings-step {
        padding: 0.5rem 0;
        margin-bottom: 0.75rem;
        display: block !important; /* Always show steps in desktop view */
        opacity: 1 !important;
        transform: none !important;
        height: auto !important;
    }

    /* Reduce spacing between elements */
    #settings-modal .mb-4 {
        margin-bottom: 0.75rem;
    }

    #settings-modal .mb-5 {
        margin-bottom: 1rem;
    }

    /* Make text areas smaller */
    #settings-modal textarea {
        max-height: 80px;
    }

    /* Hide mobile navigation buttons on desktop */
    #settings-modal .lg\\:hidden.flex.space-x-2,
    #settings-modal #settings-navigation-buttons,
    #settings-modal #connection-step-buttons,
    #settings-modal #prompt-step-buttons,
    #settings-modal #options-step-buttons,
    #settings-modal #actions-step-buttons {
        display: none !important;
        visibility: hidden !important;
        opacity: 0 !important;
        pointer-events: none !important;
    }

    /* Add section titles for desktop view */
    #settings-modal .settings-step::before {
        content: attr(data-step-name);
        display: block;
        font-weight: 600;
        font-size: 1rem;
        color: #3b82f6;
        margin-bottom: 0.5rem;
        padding-bottom: 0.25rem;
        border-bottom: 1px solid rgba(59, 130, 246, 0.3);
    }
}

/* Mobile keyboard handling for settings modal */
@media (max-width: 767px) {
    /* Base modal positioning for mobile */
    #settings-modal .modal-content {
        margin-top: 1rem;
        margin-bottom: 1rem;
        max-height: calc(100vh - 2rem);
        overflow: hidden;
        z-index: 1052;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--modal-bg);
        /* Use dvh units for better mobile support */
        max-height: calc(100dvh - 2rem);
    }

    /* When keyboard is visible, adjust modal positioning */
    #settings-modal.keyboard-visible .modal-content {
        position: fixed;
        top: 1rem;
        left: 50%;
        transform: translateX(-50%);
        max-height: calc(100vh - 2rem);
        max-height: calc(100dvh - 2rem);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    /* Content wrapper adjustments for keyboard visibility */
    #settings-modal.keyboard-visible #settings-content-wrapper {
        max-height: calc(100vh - 8rem);
        max-height: calc(100dvh - 8rem);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 2rem;
    }

    /* Ensure active step content is scrollable when keyboard is visible */
    #settings-modal.keyboard-visible .settings-step.active {
        max-height: calc(100vh - 12rem);
        max-height: calc(100dvh - 12rem);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding-bottom: 2rem;
    }

    /* Input field adjustments for mobile */
    #settings-modal input[type="text"],
    #settings-modal input[type="number"] {
        height: 44px;
        font-size: 16px !important; /* Prevent iOS zoom */
        padding: 8px 12px;
        box-sizing: border-box;
    }

    /* IP input specific adjustments */
    #settings-modal #server-ip {
        padding-left: 2.4rem !important;
        background-position: 0.6rem center !important;
        background-size: 14px !important;
    }

    /* Port input specific adjustments */
    #settings-modal #server-port {
        padding-left: 1.7rem !important;
        padding-right: 0.5rem !important;
        background-position: 0.4rem center !important;
        background-size: 10px !important;
        font-size: 0.85rem !important;
    }

    /* Navigation buttons positioning for keyboard visibility */
    #settings-modal.keyboard-visible #settings-navigation-buttons {
        position: sticky;
        bottom: 0;
        background: var(--modal-bg);
        padding: 1rem 0;
        border-top: 1px solid var(--border-color);
        z-index: 1055;
    }

    /* Close button positioning for keyboard visibility */
    #settings-modal.keyboard-visible #close-settings {
        position: sticky;
        bottom: 0;
        z-index: 1055;
        margin-top: 1rem;
    }

    /* Ensure focused inputs have proper spacing from keyboard */
    #settings-modal.keyboard-visible input:focus,
    #settings-modal.keyboard-visible textarea:focus {
        scroll-margin-bottom: 200px;
        scroll-margin-top: 100px;
    }

    /* Better touch handling for input containers */
    #settings-modal.keyboard-visible .ip-port-container {
        margin-bottom: 2rem;
    }

    /* Improved scrolling behavior */
    #settings-modal.keyboard-visible {
        scroll-behavior: smooth;
    }

    #settings-modal.keyboard-visible .settings-step.active {
        scroll-behavior: smooth;
    }
}

/* Enhanced mobile keyboard detection using viewport units */
@supports (height: 100dvh) {
    @media (max-width: 767px) {
        #settings-modal .modal-content {
            max-height: calc(100dvh - 2rem);
        }

        #settings-modal.keyboard-visible .modal-content {
            max-height: calc(100dvh - 2rem);
        }

        #settings-modal.keyboard-visible #settings-content-wrapper {
            max-height: calc(100dvh - 8rem);
        }

        #settings-modal.keyboard-visible .settings-step.active {
            max-height: calc(100dvh - 12rem);
        }
    }
}

/* Fallback for very small screens */
@media (max-width: 480px) {
    #settings-modal.keyboard-visible .modal-content {
        position: fixed;
        top: 0.5rem;
        left: 50%;
        transform: translateX(-50%);
        max-height: calc(100vh - 1rem);
        width: 95%;
    }

    #settings-modal.keyboard-visible #settings-content-wrapper {
        max-height: calc(100vh - 6rem);
    }

    #settings-modal.keyboard-visible .settings-step.active {
        max-height: calc(100vh - 10rem);
    }
}

/* Additional viewport-based responsive design */
@media (max-width: 767px) and (max-height: 600px) {
    /* For small height screens (landscape mobile) */
    #settings-modal.keyboard-visible .modal-content {
        top: 0.25rem;
        max-height: calc(100vh - 0.5rem);
    }

    #settings-modal.keyboard-visible #settings-content-wrapper {
        max-height: calc(100vh - 5rem);
    }

    #settings-modal.keyboard-visible .settings-step.active {
        max-height: calc(100vh - 8rem);
    }
}
